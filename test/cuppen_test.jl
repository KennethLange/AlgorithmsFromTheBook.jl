module CuppenTest

using LinearAlgebra, Test, AlgorithmsFromTheBook, Random

@testset "cuppen" begin
  Random.seed!(123)
  (n, tol) = (25, 1e-11);
  (a, b) = (rand(n), randn(n - 1));
  (asave, bsave) = (copy(a), copy(b));
  T = SymTridiagonal(a, b);
  (lambda, V) = cuppen(a, b, tol);
  norm_test = norm(T * V - V * Diagonal(lambda))
  lambda_test = lambda
  eigvals_test = eigvals(T)
@test norm_test ≈ 1.0025196202594178e-9
@test lambda_test ≈ [-2.3602701146672014, -1.4053025908720687, -1.219503186133101, -0.9089264294279762, -0.8345855410288787, -0.7493022847938395, -0.6860301163269397, -0.6857497138335177, -0.34296355804825135, -0.21921882970518988, 0.2892037502754799, 0.6017256442022169, 0.7099925457222135, 0.7586095138069311, 0.8804309921192701, 1.1580206975313228, 1.2030591175971503, 1.3070214186592464, 1.3585431144292326, 1.465178845398301, 1.8286095480868856, 1.8910833187964322, 1.9005753646169545, 3.0684114927443775, 3.115474659946971]
@test eigvals_test ≈ [-2.3602701146672036, -1.4053025908720673, -1.2195031861331058, -0.9089264294279736, -0.8345855410288837, -0.7493022847938384, -0.6860301163269401, -0.68574971383339, -0.34296355804824596, -0.21921882970518958, 0.28920375027547984, 0.6017256442022169, 0.7099925457222136, 0.7586095138069326, 0.8804309921192695, 1.1580206975313192, 1.2030591175971481, 1.3070214186592588, 1.3585431144292284, 1.465178845398256, 1.8286095480868845, 1.8910833187964324, 1.9005753646169552, 3.0684114927443775, 3.1154746599469627]
end
  
end
